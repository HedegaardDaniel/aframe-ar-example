<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Snowmen â€¢ A-Frame</title>
    <meta name="description" content="Place snowmen in AR using A-Frame">
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

    <script>
      // Shadow follower (from original)
      AFRAME.registerComponent('follow-shadow', {
        schema: {type: 'selector'},
        init() { this.el.object3D.renderOrder = -1; },
        tick() {
          if (this.data) {
            this.el.object3D.position.copy(this.data.object3D.position);
            this.el.object3D.position.y -= 0.001;
          }
        }
      });

      // Minimal AR hit-test for tapping to place snowmen
      AFRAME.registerComponent('tap-to-place', {
        init: function () {
          const sceneEl = this.el;

          // Listen for AR session taps
          sceneEl.addEventListener('click', function (evt) {
            const camera = sceneEl.camera.el;
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2(0, 0); // center of screen

            raycaster.setFromCamera(mouse, camera.getObject3D('camera'));
            const intersects = sceneEl.object3D.children.filter(c => c.name === 'ground');

            if (intersects.length === 0) return;

            const hit = intersects[0];
            const position = hit.position || {x:0, y:0, z:-1};

            // Clone snowman template
            const template = document.querySelector('#snowman');
            const clone = template.cloneNode(true);
            clone.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
            clone.setAttribute('visible', 'true');
            sceneEl.appendChild(clone);
          });
        }
      });
    </script>
  </head>

  <body>
    <a-scene
      reflection="directionalLight: a-light[type=directional]"
      renderer="colorManagement: true; exposure: 1; toneMapping: ACESFilmic"
      shadow="type: pcfsoft"
      xr-mode-ui="XRMode: xr"
      tap-to-place
    >
      <!-- Lighting -->
      <a-light type="directional" light="castShadow:true;" position="1 1 1" intensity="1.57" shadow-camera-automatic="#objects"></a-light>

      <!-- Camera -->
      <a-camera position="0 0.4 0"></a-camera>

      <!-- Placeholder entity for snowman template -->
      <a-entity id="objects" scale="0.2 0.2 0.2">
        <a-entity
          id="snowman"
          gltf-model="assets/models/Snowman.gltf"
          scale="0.2 0.2 0.2"
          visible="false"
          shadow="cast:true; receive:true">
        </a-entity>
      </a-entity>

      <!-- Ground plane -->
      <a-plane id="ground" rotation="-90 0 0" width="10" height="10" color="#ECECEC" shadow></a-plane>
      <a-sky color="#B0E0E6"></a-sky>
    </a-scene>
  </body>
</html>
