<a-scene 
  webxr="optionalFeatures: hit-test, local-floor; modes: ar;"
  renderer="alpha: true; colorManagement: true;"
  vr-mode-ui="enabled: false"
  loading-screen="enabled: false" 
>
  <a-assets>
    <a-asset-item id="snowman-model" src="assets/models/Snowman.gltf"></a-asset-item>
  </a-assets>

  <a-entity id="reticle" 
            ar-hit-test="target: #reticle"
            geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.08" 
            material="color: #00FF00; shader: flat" 
            rotation="-90 0 0"
            visible="false">
  </a-entity>

  <a-light type="ambient" intensity="1"></a-light>
  <a-camera position="0 1.6 0"></a-camera>

  <script>
    console.log("GitHub Pages commit 30");
    const sceneEl = document.querySelector('a-scene');
    const btn = document.querySelector('#ar-button');

    btn.addEventListener('click', () => {
      sceneEl.enterVR(true); 
    });

    sceneEl.addEventListener('enter-vr', () => {
      btn.style.display = 'none';
    });

    // SPAWN LOGIC: 
    // We listen for the 'select' event on the session 
    // which A-Frame maps to a click/tap on the screen
    sceneEl.addEventListener('ar-hit-test-select', () => {
      const reticle = document.querySelector('#reticle');
      
      // Only spawn if the reticle has found a floor (is visible)
      if (reticle.getAttribute('visible')) {
        const snowman = document.createElement('a-entity');
        snowman.setAttribute('gltf-model', '#snowman-model');
        snowman.setAttribute('scale', '0.2 0.2 0.2');
        
        // Match position and rotation of the reticle
        snowman.setAttribute('position', reticle.getAttribute('position'));
        snowman.setAttribute('rotation', reticle.getAttribute('rotation'));
        
        sceneEl.appendChild(snowman);
      }
    });
  </script>
</a-scene>