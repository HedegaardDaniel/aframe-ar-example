<!DOCTYPE html>
<html>
  <head>
    <title>AR Snowman - Final Surface Build</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      #ui {
        position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
        z-index: 1000; background: rgba(0,0,0,0.8); color: white;
        padding: 15px 25px; border-radius: 30px; font-family: sans-serif;
        border: 2px solid #fff; text-align: center;
      }
    </style>
  </head>
  <body style="margin: 0; overflow: hidden;">

    <div id="ui">TAP SCREEN TO SPAWN</div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_track;">
      
      <a-assets>
        <a-asset-item id="snowman-model" src="assets/models/Snowman.gltf"></a-asset-item>
      </a-assets>

      <a-entity id="myCam" camera look-controls></a-entity>

      <a-entity id="world"></a-entity>

      <a-light type="ambient" intensity="1.5"></a-light>
    </a-scene>

    <script>
        console.log("GitHub Pages commit 39");
      const world = document.querySelector('#world');
      const cam = document.querySelector('#myCam');

      const spawn = () => {
        console.log("Spawn triggered");
        
        // 1. Get current Camera position and direction
        const position = cam.object3D.position;
        const direction = new THREE.Vector3(0, 0, -1);
        direction.applyQuaternion(cam.object3D.quaternion);
        
        // 2. Calculate a spot 2 meters in front of the camera
        const spawnPos = new THREE.Vector3().copy(position).add(direction.multiplyScalar(2));
        
        // 3. Create the snowman
        const el = document.createElement('a-entity');
        el.setAttribute('gltf-model', '#snowman-model');
        
        // Use a box as a backup so we see SOMETHING even if model fails
        el.setAttribute('geometry', 'primitive: box; width: 0.3; height: 0.3; depth: 0.3');
        el.setAttribute('material', 'color: white; opacity: 0.8');
        
        el.setAttribute('scale', '0.5 0.5 0.5');
        el.setAttribute('position', `${spawnPos.x} ${spawnPos.y} ${spawnPos.z}`);
        
        world.appendChild(el);
      };

      // Listen for both Mouse and Touch
      window.addEventListener('mousedown', spawn);
      window.addEventListener('touchstart', (e) => {
        e.preventDefault(); // Prevents double-triggering
        spawn();
      });
    </script>
  </body>
</html>